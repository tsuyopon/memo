# 概要
HTTP/2ではフレームタイプごとにパケット構造が異なるが、これらについてまとめます。

HTTP2.mdで述べたように次の9バイトで始まる。Type(フレームタイプ)のパケット構造とTypeによって指定できるFlagsが異なります。
```
    +-----------------------------------------------+
    |                 Length (24)                   |   
    +---------------+---------------+---------------+
    |   Type (8)    |   Flags (8)   |   
    +-+-------------+---------------+-------------------------------+
    |R|                 Stream Identifier (31)                      |   
    +=+=============================================================+
    |                   Frame Payload (0...)                      ... 
    +---------------------------------------------------------------+
```

最速実装などで特に重要とされているのが、次の４つです。
- DATA(ボディを表現)
- HEADERS(ヘッダを表現)
- SETTINGS(コネクションの設定)
- GOAWAY(コネクション終了通知)

# 詳細

### DATA
HTTPリクエストやレスポンスペイロードを運ぶために利用されるタイプです。
```
    +---------------+
    |Pad Length? (8)|
    +---------------+-----------------------------------------------+
    |                            Data (*)                         ...
    +---------------------------------------------------------------+
    |                           Padding (*)                       ...
    +---------------------------------------------------------------+

                       Figure 6: DATA Frame Payload
```


### HEADERS
```
    +---------------+
    |Pad Length? (8)|
    +-+-------------+-----------------------------------------------+
    |E|                 Stream Dependency? (31)                     |
    +-+-------------+-----------------------------------------------+
    |  Weight? (8)  |
    +-+-------------+-----------------------------------------------+
    |                   Header Block Fragment (*)                 ...
    +---------------------------------------------------------------+
    |                           Padding (*)                       ...
    +---------------------------------------------------------------+

                      Figure 7: HEADERS Frame Payload
```




### PRIORITY
送信元がアドバイスする優先度を指定します。
```
    +-+-------------------------------------------------------------+
    |E|                  Stream Dependency (31)                     |
    +-+-------------+-----------------------------------------------+
    |   Weight (8)  |
    +-+-------------+

                     Figure 8: PRIORITY Frame Payload
```


### RST_STREAM
コネクションの即座の終了をするためのフレームタイプです。
RST_STREAMは次のような場合に送付されます。
- ストリームのキャンセル処理
- エラーが起こったことを伝える処理

```
    +---------------------------------------------------------------+
    |                        Error Code (32)                        |
    +---------------------------------------------------------------+

                    Figure 9: RST_STREAM Frame Payload
```


### SETTINGS
エンドポイントに対してどのように影響するかという設定値を伝えるためのフレームタイプです。
```
   +-------------------------------+
    |       Identifier (16)         |
    +-------------------------------+-------------------------------+
    |                        Value (32)                             |
    +---------------------------------------------------------------+

                         Figure 10: Setting Format
```

設定値はこの辺で規定されている
- https://www.iana.org/assignments/http2-parameters/http2-parameters.xhtml#settings

### PUSH_PROMISE
```
    +---------------+
    |Pad Length? (8)|
    +-+-------------+-----------------------------------------------+
    |R|                  Promised Stream ID (31)                    |
    +-+-----------------------------+-------------------------------+
    |                   Header Block Fragment (*)                 ...
    +---------------------------------------------------------------+
    |                           Padding (*)                       ...
    +---------------------------------------------------------------+
```

### PING
```
    +---------------------------------------------------------------+
    |                                                               |
    |                      Opaque Data (64)                         |
    |                                                               |
    +---------------------------------------------------------------+

                      Figure 12: PING Payload Format
```

### GOAWAY
このフレームタイプは次のような場合に送付されます。
- コネクションのシャットダウン
- 重大なエラー状態
```
    +-+-------------------------------------------------------------+
    |R|                  Last-Stream-ID (31)                        |
    +-+-------------------------------------------------------------+
    |                      Error Code (32)                          |
    +---------------------------------------------------------------+
    |                  Additional Debug Data (*)                    |
    +---------------------------------------------------------------+

                     Figure 13: GOAWAY Payload Format
```

### WINDOW_UPDATE
このフレームタイプはフロー制御を実装するために利用されます。
```
    +-+-------------------------------------------------------------+
    |R|              Window Size Increment (31)                     |
    +-+-------------------------------------------------------------+

                  Figure 14: WINDOW_UPDATE Payload Format
```


### CONTINUATION
```
    +---------------------------------------------------------------+
    |                   Header Block Fragment (*)                 ...
    +---------------------------------------------------------------+

                   Figure 15: CONTINUATION Frame Payload
```


### ALTSVC (RFC7838)
```
    +-------------------------------+-------------------------------+
    |         Origin-Len (16)       | Origin? (*)                 ...
    +-------------------------------+-------------------------------+
    |                   Alt-Svc-Field-Value (*)                   ...
    +---------------------------------------------------------------+

                           ALTSVC Frame Payload
```

### ORIGIN (RFC8336)
```
   +-------------------------------+-------------------------------+
   |         Origin-Entry (*)                                    ...
   +-------------------------------+-------------------------------+

   An Origin-Entry is a length-delimited string:
   +-------------------------------+-------------------------------+
   |         Origin-Len (16)       | ASCII-Origin?               ...
   +-------------------------------+-------------------------------+
```


# 参考URL
- IANA: Hypertext Transfer Protocol version 2 (HTTP/2) Parameters
  - https://www.iana.org/assignments/http2-parameters/http2-parameters.xhtml
- HTTP Alternative Services
  - https://tools.ietf.org/html/rfc7838
- The ORIGIN HTTP/2 Frame
  - https://tools.ietf.org/html/rfc8336

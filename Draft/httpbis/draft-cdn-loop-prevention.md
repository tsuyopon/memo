# CDN Loop Prevention

# 解決したい課題
CDNのループを避けるためのフィールドを定義する。
Viaヘッダが使われているがこれは流行で実態にそった使われかたをしておらず、このヘッダが付与されるとHTTP/1.1を無効にしてしまうという実装があったり、デフォルトではViaは様々な実装ではデフォルト設定で壊れているという調査結果も存在している。
CDNではDNSやフォワーディングルールのコンビによりルーティングが行われていて、サイト設定が複雑で複数の会社などによって管理している。このような場合には、非常にデバッグしづらくなる。

# 解決方法
CDNのループ回避専用のヘッダを定義することにする。そして、サーバ側ではこのヘッダの操作を規定する。

CDN-Loopヘッダによって、CDNは入力されてきたデータを既に処理したかどうかを識別することができる。 CDNはこれらのヘッダが付与されてきた場合には削除してはならない。
CDNはリクエストを転送したり生成する場合にはこのCDN-Loopヘッダに追加しなければならない。
```
CDN-Loop: FooCDN, barcdn; host="foo123.bar.cdn"
CDN-Loop: baz-cdn; abc="123"; def="456", anotherCDN
```
そして、サーバは他の目的でこのフィールドを使ってはならないことを規定する。

# 参考URL
- https://www.ietf.org/id/draft-cdn-loop-prevention-00.txt

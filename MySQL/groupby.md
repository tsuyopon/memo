# 概要
GROUP BY構文の簡単なサンプルです
sakillaデータベースから抽出しています。


# 詳細
### 特定の顧客が支払った最大値を表示したい。
paymentテーブルには特定の顧客 (customer_id)ごとに支払った金額のレコードが全て記録されています。
顧客ごとに最大の支払い金額を表示します。

```
mysql> SELECT MAX(amount), customer_id FROM payment GROUP BY customer_id LIMIT 10;
+-------------+-------------+
| MAX(amount) | customer_id |
+-------------+-------------+
|        9.99 |           1 |
|       10.99 |           2 |
|       10.99 |           3 |
|        8.99 |           4 |
|        9.99 |           5 |
|        7.99 |           6 |
|        8.99 |           7 |
|        9.99 |           8 |
|        7.99 |           9 |
|        8.99 |          10 |
+-------------+-------------+
10 rows in set (0.01 sec)
```

顧客ごとのレコード件数(COUNT)、顧客の総支払額(SUM)などももとめることが可能です。

```
mysql> SELECT COUNT(amount), SUM(amount), MAX(amount), customer_id FROM payment GROUP BY customer_id LIMIT 10;
+---------------+-------------+-------------+-------------+
| COUNT(amount) | SUM(amount) | MAX(amount) | customer_id |
+---------------+-------------+-------------+-------------+
|            32 |      118.68 |        9.99 |           1 |
|            27 |      128.73 |       10.99 |           2 |
|            26 |      135.74 |       10.99 |           3 |
|            22 |       81.78 |        8.99 |           4 |
|            38 |      144.62 |        9.99 |           5 |
|            28 |       93.72 |        7.99 |           6 |
|            33 |      151.67 |        8.99 |           7 |
|            24 |       92.76 |        9.99 |           8 |
|            23 |       89.77 |        7.99 |           9 |
|            25 |       99.75 |        8.99 |          10 |
+---------------+-------------+-------------+-------------+
10 rows in set (0.01 sec)
```

### CURRENT_DATEの形式を年月だけ切り出して、レコード数を集計する
GROUP BYで指定した値で集計して、それを表示するにはGROUP BYで指定したものと同様に「DATE_FORMAT(return_date,'%Y-%m')」と全く同じものを指定しないとエラーになります。
なお、COUNTの場合にはCOUNT(\*)と指定しないとNULLの値が正しく取得できないのでNULLがあるケースは特に注意が必要です。COUNT(DATE_FORMAT(return_date,'%Y-%m'))とするとNULLの件数が正しく表示されません。
```
mysql> SELECT COUNT(*), DATE_FORMAT(return_date,'%Y-%m') FROM rental GROUP BY DATE_FORMAT(return_date,'%Y-%m');
+----------+----------------------------------+
| COUNT(*) | DATE_FORMAT(return_date,'%Y-%m') |
+----------+----------------------------------+
|      183 | NULL                             |
|      395 | 2005-05                          |
|     3071 | 2005-06                          |
|     4188 | 2005-07                          |
|     8145 | 2005-08                          |
|       62 | 2005-09                          |
+----------+----------------------------------+
6 rows in set (0.02 sec)
```

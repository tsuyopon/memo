# 概要
sakilaデータベースを使ってjoinに使えそうなことをまとめる


### JOINのパターン
たった、3つのパターンだけのようだ
- inner join
  - 1:1の関係で結合する
- left join
  - 左にあるテーブルを元に結合する
- right join
  - 右にあるテーブルを元に結合する

この他にも次のように煩わしいのがあるがきほんは上記の３つらしい
- outer join
- cross join
- left outer join
- right outer join


### ある列で並べて、さらに別の列で並べる
ORDER BYの後にカラムを順番に記述します。  
postal_codeやlast_updateは桁違いの場合8000,900,9000のように意図しない順番になります。
```
mysql> SELECT * FROM address ORDER BY postal_code, last_update DESC;
```

次のように+0などを入れると数値と解釈して意図した結果となります。
```
mysql> SELECT * FROM address ORDER BY postal_code+0, last_update+0 DESC;
```

### 特定のカテゴリで足しあわせを行う
actor_idは複数のfilm_idを持つ。以下の例ではactor_id毎にfilm_idのSUM, AVG, MIN, MAX, COUNT表示している。  
ただし、件数が200件と多いので180番目のactor_id以降を表示した例です。
```
mysql> SELECT actor_id, SUM(film_id), AVG(film_id), MIN(film_id), MAX(film_id), COUNT(film_id) FROM film_actor GROUP BY actor_id HAVING(actor_id) > 180;
+----------+--------------+--------------+--------------+--------------+----------------+
| actor_id | SUM(film_id) | AVG(film_id) | MIN(film_id) | MAX(film_id) | COUNT(film_id) |
+----------+--------------+--------------+--------------+--------------+----------------+
|      181 |        19950 |     511.5385 |            5 |          991 |             39 |
|      182 |        13856 |     577.3333 |           33 |          990 |             24 |
|      183 |        10177 |     535.6316 |           32 |          983 |             19 |
|      184 |        16955 |     584.6552 |           35 |          985 |             29 |
|      185 |        17348 |     578.2667 |            7 |          973 |             30 |
|      186 |         8143 |     508.9375 |           95 |          994 |             16 |
|      187 |        14006 |     424.4242 |           17 |          976 |             33 |
|      188 |        13794 |     459.8000 |            1 |          989 |             30 |
|      189 |        13388 |     557.8333 |           43 |          940 |             24 |
|      190 |        13115 |     485.7407 |           38 |          959 |             27 |
|      191 |        17888 |     596.2667 |           16 |          993 |             30 |
|      192 |        13991 |     482.4483 |           16 |          819 |             29 |
|      193 |        11324 |     492.3478 |           44 |          960 |             23 |
|      194 |         8571 |     389.5909 |            9 |          940 |             22 |
|      195 |        15031 |     556.7037 |          129 |          962 |             27 |
|      196 |        16814 |     560.4667 |           64 |          972 |             30 |
|      197 |        16990 |     514.8485 |            6 |          995 |             33 |
|      198 |        21894 |     547.3500 |            1 |          997 |             40 |
|      199 |         7715 |     514.3333 |           67 |          953 |             15 |
|      200 |         9706 |     485.3000 |            5 |          993 |             20 |
+----------+--------------+--------------+--------------+--------------+----------------+
20 rows in set (0.01 sec)
```

### joinしてみる
```
mysql> SELECT * FROM city AS ci LEFT JOIN country AS co ON ci.country_id = co.country_id LIMIT 10;
+---------+--------------------+------------+---------------------+------------+----------------------+---------------------+
| city_id | city               | country_id | last_update         | country_id | country              | last_update         |
+---------+--------------------+------------+---------------------+------------+----------------------+---------------------+
|       1 | A Corua (La Corua) |         87 | 2006-02-15 04:45:25 |         87 | Spain                | 2006-02-15 04:44:00 |
|       2 | Abha               |         82 | 2006-02-15 04:45:25 |         82 | Saudi Arabia         | 2006-02-15 04:44:00 |
|       3 | Abu Dhabi          |        101 | 2006-02-15 04:45:25 |        101 | United Arab Emirates | 2006-02-15 04:44:00 |
|       4 | Acua               |         60 | 2006-02-15 04:45:25 |         60 | Mexico               | 2006-02-15 04:44:00 |
|       5 | Adana              |         97 | 2006-02-15 04:45:25 |         97 | Turkey               | 2006-02-15 04:44:00 |
|       6 | Addis Abeba        |         31 | 2006-02-15 04:45:25 |         31 | Ethiopia             | 2006-02-15 04:44:00 |
|       7 | Aden               |        107 | 2006-02-15 04:45:25 |        107 | Yemen                | 2006-02-15 04:44:00 |
|       8 | Adoni              |         44 | 2006-02-15 04:45:25 |         44 | India                | 2006-02-15 04:44:00 |
|       9 | Ahmadnagar         |         44 | 2006-02-15 04:45:25 |         44 | India                | 2006-02-15 04:44:00 |
|      10 | Akishima           |         50 | 2006-02-15 04:45:25 |         50 | Japan                | 2006-02-15 04:44:00 |
+---------+--------------------+------------+---------------------+------------+----------------------+---------------------+
10 rows in set (0.00 sec)
```

### 存在するかどうかをチェックする
存在するかどうかをチェックする場合にはEXISTSが使える。存在しない場合には「NOT EXISTS」にすればよい。
```
mysql> SELECT EXISTS (SELECT * FROM address ORDER BY postal_code, last_update DESC);
+-----------------------------------------------------------------------+
| EXISTS (SELECT * FROM address ORDER BY postal_code, last_update DESC) |
+-----------------------------------------------------------------------+
|                                                                     1 |
+-----------------------------------------------------------------------+
1 row in set (0.00 sec)
```

# 参考URL 
- http://blog.livedoor.jp/sasata299/archives/51106595.html
- http://stackoverflow.com/questions/5706437/whats-the-difference-between-inner-join-left-join-right-join-and-full-join
- https://www.codeproject.com/kb/database/visual_sql_joins.aspx

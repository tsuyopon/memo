(WARNING)ちゃんと検証できていないので間違っている可能性十分にあり

# 概要
アルパカ攻撃について(application layer protocol content confusion attack)
Cross-Protocol Attack

# 攻撃概要
HTTPSから特定のサイト(www.bank.com:443)に接続した際に、中間者によって同じサブドメインの別のプロトコル(ftp.bank.com:990)に飛ばされることで以下の３つの攻撃の可能性がありうる。
詳細は本家の図を参照のこと
- 1. Cookieの取得
  - リクエストに付与したCookieが別のドメインに取得されてしまうこと
- 2. ダウンロード攻撃
  - サーバから意図的に何かをダウンロードさせるような文字列を応答してXSS攻撃を発生させる仕組み
- 3. reflect攻撃
  - リクエストした際に付与した文字列が、そのまま相手に送られてXSS攻撃となってしまうこと(図の例では、FTPがコマンドを解釈できずに、リクエストをそのままreflectしてしまっている)

しかし、上記が発生するには条件がありそうである。
- 最初のHTTPSのリクエストが攻撃者のドメイン(図中ではwww.atacker.com)を指し示すように改竄されていること
- ワイルドカード\*.bank.comの証明書やマルチドメイン証明書がwww.bank.com:443及びftp.bank.com:990と別プロトコルのエンドポイントで使われていること
- 2の攻撃をするためにはftp.bank.com側を改竄できなければダウンロード攻撃やreflect攻撃を実行させることは難しいのかも。
- TLSを利用したSMTP, IMAP, POP3, FTPのような別のプロトコルALPNに対応していないこと  (実際にHTTPSサーバ実装はHTTP/2の背景もあり大抵がALPNに対応しているが、他のプロトコルはALPNに対応していないことが多い)

# 対応方法
- クライアント及び、サーバ側の実装がALPNに対応できていることで、接続に使用しているプロトコルが異なれば実装で弾くことが可能
  - HTTPS以外のTLSを使う実装でも、ALPNに対応した実装になっている必要がある。
- サーバ側の実装がSNIで証明書出しわけに対応できていること。さらにエンドポイントごとに異なるドメインを使うようにすること(ワイルドカードを利用することが今回の攻撃にもつながるかも)

# 資料
- https://alpaca-attack.com/
  - アルパカ攻撃の概要について説明した本家ウェブサイト
- https://alpaca-attack.com/ALPACA.pdf
  - アルパカ攻撃について記載された論文
- https://github.com/RUB-NDS/alpaca-code/
  - 検証用コード

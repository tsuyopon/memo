# 概要
ロードバランサについて

### L2DSRとは
一言でいうと、LBがMACアドレス書き換えを行うことによって実現する方式です。
- 1. あらかじめロードバランサ配下のサーバにはloopbackアドレスとしてロードバランサのIPを設定しておく
- 2. リクエストが来ると、ロードバランサが宛先MACアドレスをロードバランサ配下にある負荷分散対象のサーバのMACアドレスに書き換える。SrcIpやDstIpは書き換えない。
- 3. サーバにリクエストが来るとDstIpはloopbackに設定されているので自身のパケットであると解釈する。
- 4. ロードバランサを経由せずにクライアントにパケットを直接返すことが可能(Direct Server Return)

L2DSRを使うと次のメリットがあります。
- 全体のスループットが上がります。

デメリットとしては
- リアルサーバでVIP設定やロードバランサを経由しないstaticルートの設定が必要

### L3DSRとは
一言でいうと、LBがL3レイヤーのビットを書き換えて、リアルサーバがそれをチェックしてSrcアドレスをVIPアドレスとして変換する方式です。

- 1. リクエストが送られてくる。
- 2. ロードバランサに到達するとDstIPを負荷分散対象サーバに書き換えて、TOSビット(DSCP)を0x22に書き換える
- 3. リアルサーバではDSCPが0x22ならば、SrcIPアドレスをVIPアドレスに変換して、直接クライアントに返却する。


- 参考
  - https://www.janog.gr.jp/meeting/janog33/doc/janog33-lbaas-miyata-1.pdf

### L4とL7ロードバランサの違い
図解付きで比較していてわかりやすい
- https://www.janog.gr.jp/meeting/janog32/program/lb.html

